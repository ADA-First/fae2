{% extends "base.html" %}
{% load staticfiles i18n %}

{% block breadcrumb %}
    <li><a href="{% url 'show_report'       report.slug view %}">Summary</a></li>
    <li><a href="{% url 'show_report_group' report.slug view group.slug %}">{{group.get_title}}</a></li>
    <li>{{ws_rule_result.rule.nls_rule_id}}</li>
{% endblock %}


{% block content %}
  <h1 id="id_h1_title">{{ws_rule_result.rule.nls_rule_id}}: {{ws_rule_result.rule.summary_html|safe}}</h1>

  {% include "reports/report_information.html" %}


<script type="text/javascript">

function showHide(event) {

    function clearActive() {

        var i = 1;
        var node1 = document.getElementById('shb' + i)

        while (node1) {

            node1.parentNode.className = "";
            node1.setAttribute('aria-expanded', false);

            node2 = document.getElementById('shp' + i)
            if (node2) node2.setAttribute('hidden', '')

            i = i + 1;
            node1 = document.getElementById('shb' + i);
        }

    }

    var type = event.type.toLowerCase();
    var target = event.currentTarget;

    if ((type === 'click') || 
        (type === 'keydown' && event.keyCode === 32)) {

        clearActive();

        target.parentNode.className = "active";
        target.setAttribute('aria-expanded', true);

        node2 = document.getElementById(target.id.replace('b', 'p'));
        if (node2) node2.removeAttribute('hidden');

        event.preventDefault();
        event.stopPropagation();    

    }

}

</script>


<nav id="view_options" aria-label="Page view options">
    <ul class="nav nav-tabs">
        <li><a id="shb1" role="button" href="#rule_details" onclick="showHide(event)" onkeydown="showHide(event)" aria-expanded="false">Details/Actions</a></li>
        <li class="active"><a id="shb2" role="button" href="#page_results" onclick="showHide(event)" onkeydown="showHide(event)"   aria-expanded="true">Page Results</a></li>
    </ul>
</nav>  

<div id="shp1" hidden>
{% include "reports/rule_details.html" with rule=ws_rule_result.rule %}
</div>

<div id="shp2">

    <section aria-label="Page Results">
        <h2>Page Results</h2>
        <table  id="id_table_show_summary" class="details table table-striped table-hover sortable"  aria-labelledby="id_h1_title"  aria-describedby="id_result_description">
            <thead>
              <tr>
                <th id="id_pgn" class="num"  rowspan="2">Page</th>
                <th id="id_ttl" class="text"  rowspan="2">Page Title</th>
                <th id="id_nor" class="text"  colspan="4">Element Results</th>
                <th id="id_imp" class="text"  colspan="3">Implementation Scores</th>
              </tr>
              <tr>
                <th id="id_vio" class="num"  ><abbr title="Violations">V</abbr></th>
                <th id="id_war" class="num"  ><abbr title="Warnings">W</abbr></th>
                <th id="id_man" class="num"  ><abbr title="Manual Checks">MC</abbr></th>
                <th id="id_pas" class="num"  ><abbr title="Passed">P</abbr></th>
                <th id="id_pfi" class="num"  ><abbr title="Pass/Fail Implementation Score">Pass/Fail</abbr></th>
                <th id="id_ovr" class="num"  ><abbr title="Pass/Fail/manual Checks Implementation Score">Pass/Fail/MC</abbr></th>
                <th id="id_sta" class="text"  ><abbr title="Implementation Status">Status</abbr></th>
              </tr>  
            </thead>
            <tbody>
                {% for prr in ws_rule_result.page_rule_results.all %} 
                <tr>
                    <td id="id_r{{forloop.counter}}" class="text" headers="id_pgn">
                        {{prr.page_result.page_number}}
                    </td>

                    <td id="id_r{{forloop.counter}}" class="text" headers="id_pgn">
                      <a href="{% url 'show_report_group_rule_page' report.slug view group.slug prr.slug prr.page_result.page_number %}">
                        {{prr.page_result.title}}
                      </a>
                    </td>

                    <td class="num"  headers="id_r{{forloop.counter}} id_vio">
                    {% if prr.elements_violation > 0 %}
                    {{prr.elements_violation}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                    <td class="num"  headers="id_r{{forloop.counter}} id_war">
                    {% if prr.elements_warning > 0 %}
                    {{prr.elements_warning}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                    <td class="num"  headers="id_r{{forloop.counter}} id_man">
                    {% if prr.elements_manual_check > 0 %}
                    {{prr.element_manual_check}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                    <td class="num"  headers="id_r{{forloop.counter}} id_pas">
                    {% if prr.elements_passed > 0 %}
                    {{prr.elements_passed}}
                    {% else %}
                    -
                    {% endif %}
                    </td>


                   <td class="num"  headers="id_r{{forloop.counter}} id_pfi">
                    {% if prr.implementation_pass_fail_score >= 0 %}
                    {{prr.implementation_pass_fail_score}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                   <td class="num"  headers="id_r{{forloop.counter}} id_ovr">
                    {% if prr.implementation_score >= 0 %}
                    {{prr.implementation_score}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                   <td class="text"  headers="id_r{{forloop.counter}} id_sta">
                    {{prr.implementation_status}}
                    </td>

                </tr>    
                {% endfor %}
            </tbody>
            <tbody>    
                <tr class="summary">
                    <td class="text">
                        
                    </td>

                    <td id="id_all" class="text" headers="id_pgn">
                    All Pages
                    </td>

                    <td class="num"  headers="id_all id_vio">
                    {% if ws_rule_result.elements_violation > 0 %}
                    {{ws_rule_result.elements_violation}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                    <td class="num"  headers="id_all id_war">
                    {% if ws_rule_result.elements_warning > 0 %}
                    {{ws_rule_result.elements_warning}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                    <td class="num"  headers="id_all id_man">
                    {% if ws_rule_result.elements_manual_check > 0 %}
                    {{ws_rule_result.mc_identified}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                    <td class="num"  headers="id_all id_pas">
                    {% if ws_rule_result.elements_passed > 0 %}
                    {{ws_rule_result.elements_passed}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                   <td class="num"  headers="id_all id_pfi">
                    {% if ws_rule_result.implementation_pass_fail_score >= 0 %}
                    {{ws_rule_result.implementation_pass_fail_score}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                   <td class="num"  headers="id_all id_ovr">
                    {% if ws_rule_result.implementation_score >= 0 %}
                    {{ws_rule_result.implementation_score}}
                    {% else %}
                    -
                    {% endif %}
                    </td>

                   <td class="text"  headers="id_all id_sta">
                    {{ws_rule_result.implementation_status}}
                    </td>

                </tr>    
             </tbody>
        </table>    
    </section>    
</div>


{% endblock %}