{% extends "base.html" %}
{% load staticfiles i18n %}

{% block title %}
  Run FAE
{% endblock %}

{% block content %}

<form id="id_run_report"  action="{% url 'run_report' %}" method="post" >
    {% csrf_token %}

    {% include "forms/input_report_get_last.html" %}

    {% include "forms/input_report_url.html" %}

    {% include "forms/input_report_title.html" %}

    {% include "forms/input_report_depth.html" %}
    
    {% include "forms/input_report_domains.html" %}
    
    {% include "forms/input_report_ruleset.html" %}
    
    {% include "forms/input_report_max_pages.html" %}
    
    <div class="fae_button">
        <input id="id_submit" name="submit" type="submit" value="Evaluate"  title="You must enter a valid URL and a title before you can request a report"/>
    </div>

</form>

{% endblock %}

{% block javascript %}

<script src="{% static 'js/url-validation.js' %}" type="text/javascript"></script>

<script src="{% static 'js/form-control-focus.js' %}" type="text/javascript"></script>

<script type="text/javascript">

  var last_report = {};

  {% if last_report %}
  last_report.url        = "{{last_report.url}}";
  last_report.title      = "{{last_report.title}}";
  last_report.ruleset_id = "{{last_report.ruleset.id}}";
  last_report.depth      = {{last_report.depth}};
  last_report.max_pages  = {{last_report.max_pages}};
  last_report.depth_id   = "id_depth_" + last_report.depth.toString();

  last_report.follow              = {{last_report.follow}};
  last_report.require_path        = {% if last_report.require_path %}true{% else %}false{% endif %};
  last_report.path                = "{{last_report.path}}";
  last_report.span_sub_domains    = "{{last_report.span_sub_domains}}";
  last_report.exclude_domains     = "{{last_report.exclude_domains}}";
  last_report.include_domains     = "{{last_report.include_domains}}";
  {% else %}
  last_report.url        = "";
  last_report.title      = "";
  last_report.ruleset_id = "";
  last_report.depth      = 0;
  last_report.max_pages  = 0;
  last_report.depth_id   = "id_depth_2";
  
  last_report.follow              = 1;
  last_report.require_path        = false;
  last_report.path                = "";
  last_report.span_sub_domains    = "";
  last_report.exclude_domains = "";
  last_report.include_domains     = "";
  {% endif %}

  function getLastReport() {
  
    if (last_report.url) {
      document.getElementById("id_input_url").value   = last_report.url;
      document.getElementById("id_input_title").value = last_report.title;

      document.getElementById(last_report.depth_id).checked = true;
      document.getElementById("id_input_require_path").checked = last_report.require_path;
      
      if (last_report.follow === 3) {
        document.getElementById("id_follow_3").checked = true;
      }
      else {
        if (last_report.follow === 2) {
          document.getElementById("id_follow_2").checked = true;
        }
        else {
          document.getElementById("id_follow_1").checked = true;
        }
      }

      document.getElementById("id_ruleset_" + last_report.ruleset_id).checked = true;

      var max_page_input = document.getElementById("max_pages_" + last_report.max_pages);

      if (max_page_input && !max_page_input.disabled) max_page_input.checked = true;

      enableSubmit();
      updateFollow();

    }
  }


</script>

{% endblock %}